version: '3.8'

services:
 devcontainer:
  build:
   context: ..
   dockerfile: .devcontainer/Dockerfile
  volumes:
    - ..:/workspaces/haystack:cached
  command: sleep infinity
  
 weaviate:
  command:
    - --host
    - 0.0.0.0
    - --port
    - '8080'
    - --scheme
    - http
  image: semitechnologies/weaviate:1.17.0
  ports:
    - "8080:8080"
  restart: on-failure:0
  environment:
    QUERY_DEFAULTS_LIMIT: 25
    AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'true'
    PERSISTENCE_DATA_PATH: '/var/lib/weaviate'
    DEFAULT_VECTORIZER_MODULE: 'none'
    ENABLE_MODULES: ''
    CLUSTER_HOSTNAME: 'node1'

 elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.6
    ports:
      - 9200:9200
    restart: on-failure
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"